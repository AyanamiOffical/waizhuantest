var b=(e,t,a)=>new Promise((o,n)=>{var i=s=>{try{f(a.next(s))}catch(p){n(p)}},y=s=>{try{f(a.throw(s))}catch(p){n(p)}},f=s=>s.done?o(s.value):Promise.resolve(s.value).then(i,y);f((a=a.apply(e,t)).next())});import{cy as _,ap as C,bp as $}from"./bootstrap-BWmjjFp9.js";import{c as j,g as O,a as S}from"./authority-CweiRpJC.js";import{V as q,O as D,Z as R,_ as B,$ as I,x as K,U as w}from"../jse/index-index-DuhpPpLg.js";import{u as E}from"./use-modal-CjlieS99.js";import{T as U}from"./index-D6KiMP1x.js";var z={done:!1,hasNext:!1};function M(e,...t){let a=e,o=t.map(i=>"lazy"in i?V(i):void 0),n=0;for(;n<t.length;){if(o[n]===void 0||!L(a)){let s=t[n];a=s(a),n+=1;continue}let i=[];for(let s=n;s<t.length;s++){let p=o[s];if(p===void 0||(i.push(p),p.isSingle))break}let y=[];for(let s of a)if(T(s,y,i))break;let{isSingle:f}=i.at(-1);a=f?y[0]:y,n+=i.length}return a}function T(e,t,a){var y;if(a.length===0)return t.push(e),!1;let o=e,n=z,i=!1;for(let[f,s]of a.entries()){let{index:p,items:A}=s;if(A.push(o),n=s(o,p,A),s.index+=1,n.hasNext){if((y=n.hasMany)!=null&&y){for(let x of n.next)if(T(x,t,a.slice(f+1)))return!0;return i}o=n.next}if(!n.hasNext)break;n.done&&(i=!0)}return n.hasNext&&t.push(o),i}function V(e){var n;let{lazy:t,lazyArgs:a}=e,o=t(...a);return Object.assign(o,{isSingle:(n=t.single)!=null?n:!1,index:0,items:[]})}function L(e){return typeof e=="string"||typeof e=="object"&&e!==null&&Symbol.iterator in e}function P(e,t){let a=t.length-e.length;if(a===1){let[o,...n]=t;return M(o,{lazy:e,lazyArgs:n})}if(a===0){let o={lazy:e,lazyArgs:t};return Object.assign(n=>M(n,o),o)}throw new Error("Wrong number of arguments")}function W(...e){return P(Z,e)}function Z(){let e=new Set;return t=>e.has(t)?z:(e.add(t),{done:!1,hasNext:!0,next:t})}function F(e){return typeof e=="number"&&!Number.isNaN(e)}function G(...e){return _(N,e)}function N(e,t=[],a=[]){if(typeof e=="function")return e;if(typeof e!="object"||e===null||e instanceof Date||e instanceof RegExp)return structuredClone(e);let o=t.indexOf(e);return o!==-1?a[o]:(t.push(e),Array.isArray(e)?J(e,t,a):H(e,t,a))}function H(e,t,a){let o={};a.push(o);for(let[n,i]of Object.entries(e))o[n]=N(i,t,a);return o}function J(e,t,a){let o=[];a.push(o);for(let[n,i]of e.entries())o[n]=N(i,t,a);return o}function Q(...e){return _(X,e)}var X=(e,t)=>[...e,...t];const re=q({name:"ApiAuthorityModal",__name:"api-authority",setup(e,{expose:t}){const a=D([]),o=D(),n=D();let i={code:0,msg:"",data:{total:0,data:[]}};const[y,f]=E({fullscreenButton:!1,onCancel(){f.close()},onConfirm:()=>b(this,null,function*(){const u=A(o.value,i.data.data);(yield j({roleId:Number(n.value),data:u})).code===0&&$.success(C("common.successful")),f.close()}),onOpenChange(u){var c;n.value=u?((c=f.getData())==null?void 0:c.roleId)||{}:{},u&&s()},title:C("sys.authority.apiAuthority")});function s(){return b(this,null,function*(){try{a.value=[];const u=yield O({page:1,pageSize:1e4});i=u;const c=p(u.data.data);for(const d in c)a.value.push(c[d]);const l=yield S({id:n.value});o.value=l.data.data===null?x([],u.data.data):x(l.data.data,u.data.data)}catch(u){}})}function p(u){var r,g;const c=[],l=[];if(u.length===0)return l;const d=new Map,m=new Map;for(const h of u)d.set(h.group,h.serviceName),m.set(h.serviceName,!0);for(const h of d.keys()){const v={title:h,key:h,children:[]};for(const k of u)k.group===h&&((r=v.children)==null||r.push({title:k.trans,key:k.id,disableCheckbox:k.isRequired}));l.push(v)}for(const h of m.keys()){const v={title:h,key:h,children:[]};for(const k of l)d.get(k.title)===h&&((g=v.children)==null||g.push(G(k)));c.push(v)}return c}function A(u,c){const l=[];for(const r of u)F(r)&&l.push(r);c.sort((r,g)=>r.id!==void 0&&g.id!==void 0?r.id-g.id:1),l.sort((r,g)=>r-g);const d=[];let m=0;for(const r of c)r.id===l[m]&&(d.push({path:r.path,method:r.method}),m++);return d}function x(u,c){const l=new Map,d=[],m=[];c.forEach((r,g)=>{r.isRequired&&m.push(r.id)});for(const r of c)l.set(r.path+r.method,r.id);for(const r of u)d.push(l.get(r.path+r.method));return W(Q(d,m))}return t(f),(u,c)=>(B(),R(w(y),null,{default:I(()=>[K(w(U),{"checked-keys":o.value,"onUpdate:checkedKeys":c[0]||(c[0]=l=>o.value=l),"tree-data":a.value,checkable:"","default-expand-all":""},null,8,["checked-keys","tree-data"])]),_:1}))}});export{re as _};
