var f=(g,u,n)=>new Promise((r,i)=>{var p=a=>{try{c(n.next(a))}catch(m){i(m)}},l=a=>{try{c(n.throw(a))}catch(m){i(m)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(p,l);c((n=n.apply(g,u)).next())});import{aq as V,ap as t,ar as S,a$ as v,b0 as x}from"./bootstrap-D7b_84de.js";import{g as B,a as N}from"./captcha-CFSTPVeG.js";import{T as k}from"./auth-title-CfHZ7KYu.js";import{V as _,am as I,J as $,ak as F,_ as L,x as h,as as q,$ as b,X as y,a5 as w,a6 as T,U as o,aW as R,O as P,Z as A}from"../jse/index-index-DpiZBZ8E.js";import{u as E,s as d}from"./use-vben-form-BpU-Ov5A.js";import"./index-CCviRy07.js";import"./render-content.vue_vue_type_script_lang-BnMYg2_n.js";const D=_({name:"ForgetPassword",__name:"forget-password",props:{formSchema:{},loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(g,{expose:u,emit:n}){const r=g,i=n,[p,l]=E(I({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:$(()=>r.formSchema),showDefaultActions:!1})),c=V();function a(){return f(this,null,function*(){const{valid:e}=yield l.validate(),s=yield l.getValues();e&&i("submit",s)})}function m(){c.push(r.loginPath)}return u({getFormApi:()=>l}),(e,s)=>(L(),F("div",null,[h(k,null,{desc:b(()=>[y(e.$slots,"subTitle",{},()=>[w(T(e.subTitle||o(t)("authentication.forgetPasswordSubtitle")),1)])]),default:b(()=>[y(e.$slots,"title",{},()=>[w(T(e.title||o(t)("authentication.forgetPassword"))+" 🤦🏻‍♂️ ",1)])]),_:3}),h(o(p)),q("div",null,[h(o(S),{class:R([{"cursor-wait":e.loading},"mt-2 w-full"]),"aria-label":"submit",onClick:a},{default:b(()=>[y(e.$slots,"submitButtonText",{},()=>[w(T(e.submitButtonText||o(t)("authentication.sendResetLink")),1)])]),_:3},8,["class"]),h(o(S),{class:"mt-4 w-full",variant:"outline",onClick:s[0]||(s[0]=C=>m())},{default:b(()=>[w(T(o(t)("common.back")),1)]),_:1})])]))}}),j=_({name:"ForgetPassword",__name:"forget-password",setup(g){const u=V(),n=[{label:t("sys.login.mobile"),value:"mobile"},{label:t("sys.login.email"),value:"email"}],r=P(""),i=P(""),p=P(""),l=P(!1);function c(){return f(this,null,function*(){return p.value==="email"?(yield B({email:i.value})).code===0:(yield N({phoneNumber:i.value})).code===0})}const a=[{component:"VbenSelect",componentProps:{options:n},label:"Login Type",fieldName:"selectLoginType",rules:d().optional().default("email"),dependencies:{triggerFields:["selectLoginType"],trigger(e,s){p.value=e.selectLoginType}},formItemClass:"col-span-2 items-baseline"},{component:"VbenInput",componentProps:{placeholder:r},label:"Target",fieldName:"target",dependencies:{trigger(e,s){r.value=e.selectLoginType==="email"?t("sys.login.emailPlaceholder"):t("sys.login.mobilePlaceholder"),i.value=e.target},triggerFields:["selectLoginType","target"]},rules:d().min(5),formItemClass:"col-span-2 items-baseline"},{component:"VbenPinInput",componentProps:{createText:e=>e>0?t("authentication.sendText",[e]):t("authentication.sendCode"),placeholder:t("authentication.code"),codeLength:5,handleSendCode:c},fieldName:"captchaVerified",label:t("authentication.code"),rules:d().length(5,{message:t("sys.login.captchaRequired")}).max(5),formItemClass:"col-span-2 items-baseline"},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:t("authentication.password")},renderComponentContent(){return{strengthText:()=>t("authentication.passwordStrength")}},fieldName:"password",label:t("authentication.password"),rules:d().min(6,{message:t("authentication.passwordTip")}),formItemClass:"col-span-2 items-baseline"},{component:"VbenInputPassword",componentProps:{placeholder:t("authentication.confirmPassword")},dependencies:{rules(e){const{password:s}=e;return d({required_error:t("authentication.passwordTip")}).min(1,{message:t("authentication.passwordTip")}).refine(C=>C===s,{message:t("authentication.confirmPasswordTip")})},triggerFields:["password"]},fieldName:"confirmPassword",label:t("authentication.confirmPassword"),formItemClass:"col-span-2 items-baseline"}];function m(e){return f(this,null,function*(){e.selectLoginType==="email"?(yield v({email:e.target,captcha:e.captchaVerified,password:e.password})).code===0&&u.replace("/auth/login"):(yield x({phoneNumber:e.target,captcha:e.captchaVerified,password:e.password})).code===0&&u.replace("/auth/login")})}return(e,s)=>(L(),A(o(D),{"form-schema":a,loading:l.value,"sub-title":o(t)("sys.login.resetPassword"),"submit-button-text":o(t)("common.resetText"),onSubmit:m},null,8,["loading","sub-title","submit-button-text"]))}});export{j as default};
