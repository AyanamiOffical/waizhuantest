var f=(l,r,o)=>new Promise((n,d)=>{var u=t=>{try{m(o.next(t))}catch(s){d(s)}},c=t=>{try{m(o.throw(t))}catch(s){d(s)}},m=t=>t.done?n(t.value):Promise.resolve(t.value).then(u,c);m((o=o.apply(l,r)).next())});import{u as v}from"./form-CK_zT3Xn.js";import{ap as e,bp as b,dd as N,de as I}from"./bootstrap-BWmjjFp9.js";import{g as S}from"./department-OwGYML4b.js";import{g as x}from"./position-BbZ2PvWe.js";import{g as F}from"./role-CTgpJyrr.js";import{s as i}from"./use-vben-form-67dA5BCn.js";import{k,V as P,O as g,Z as _,_ as A,$ as U,x as C,U as w}from"../jse/index-index-DuhpPpLg.js";import D from"./index-CRapU7To.js";import{u as V}from"./use-modal-CjlieS99.js";const Z={columns:[{type:"checkbox",width:60},{title:e("sys.login.username"),field:"username"},{title:e("sys.user.nickname"),field:"nickname"},{title:e("sys.login.email"),field:"email"},{title:e("common.status"),field:"status",slots:{default:l=>k(D,{checked:l.row.status===1,onClick:()=>{if(l.row.username==="admin"){b.warn(e("sys.role.adminStatusChangeForbidden"));return}const r=l.row.status===1?2:1;N({id:l.row.id,status:r}).then(()=>{l.row.status=r})}})}},{title:e("common.createTime"),field:"createdAt",formatter:"formatDateTime"}]},E={schema:[{fieldName:"username",label:e("sys.login.username"),component:"Input"},{fieldName:"nickname",label:e("sys.user.nickname"),component:"Input"},{fieldName:"roleIds",label:e("sys.role.roleTitle"),component:"ApiSelect",componentProps:{api:F,params:{page:1,pageSize:100},resultField:"data.data",labelField:"trans",valueField:"id",multiple:!0}},{fieldName:"mobile",label:e("sys.login.mobile"),component:"Input"},{fieldName:"email",label:e("sys.login.email"),component:"Input"},{fieldName:"description",label:e("sys.user.description"),component:"Input"}]},T={schema:[{fieldName:"avatar",label:e("sys.user.avatar"),component:"ImageUpload",componentProps:{accept:["png","jpeg","jpg"],maxSize:2,maxNumber:1,multiple:!1,provider:"cloud-default"}},{fieldName:"id",label:"ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"username",label:e("sys.login.username"),component:"Input",rules:i().max(50)},{fieldName:"nickname",label:e("sys.user.nickname"),component:"Input",rules:i().max(40)},{fieldName:"description",label:e("sys.user.description"),component:"Input",rules:i().max(100).optional()},{fieldName:"homePath",label:e("sys.user.homePath"),defaultValue:"/dashboard",component:"Input",rules:i().max(70).optional(),help:e("sys.role.defaultRouterHelpMessage")},{fieldName:"mobile",label:e("sys.login.mobile"),component:"Input",rules:i().max(20).optional()},{fieldName:"email",label:e("sys.login.email"),component:"Input",rules:i().email()},{fieldName:"password",label:e("sys.login.password"),component:"Input",rules:i().min(6).max(100).optional()},{fieldName:"roleIds",label:e("sys.role.roleTitle"),component:"ApiSelect",componentProps:{api:F,params:{page:1,pageSize:100},resultField:"data.data",labelField:"trans",valueField:"id",multiple:!0},rules:"required"},{fieldName:"departmentId",label:e("sys.department.userDepartment"),component:"ApiTreeSelect",componentProps:{api:S,params:{page:1,pageSize:1e3},resultField:"data.data",labelField:"trans",valueField:"id"},rules:"required"},{fieldName:"positionId",label:e("sys.position.userPosition"),component:"ApiSelect",componentProps:{api:x,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"trans",valueField:"id",multiple:!0},rules:"required"},{fieldName:"status",label:e("common.status"),component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:e("common.on"),value:1},{label:e("common.off"),value:2}]},rules:"required"}]},J=P({name:"UserForm",__name:"form",setup(l,{expose:r}){const o=g(),n=g(!1),d=g();function u(a){return f(this,null,function*(){if(n.value===!1&&(a.password===void 0||a.password.length===0)){b.error(e("sys.login.passwordPlaceholder"));return}const p=n.value?yield N(a):yield I(a);p.code===0&&(b.success(p.msg),d.value.reload())})}const[c,m]=v({handleSubmit:u,schema:[...T.schema],showDefaultActions:!1,layout:"vertical"}),[t,s]=V({fullscreenButton:!1,onCancel(){s.close()},onConfirm:()=>f(this,null,function*(){const a=yield m.submitForm();n.value===!1&&(a.password===void 0||a.password.length===0)||s.close()}),onOpenChange(a){var p,y,h;n.value=(p=s.getData())==null?void 0:p.isUpdate,o.value=a?((y=s.getData())==null?void 0:y.record)||{}:{},d.value=a?(h=s.getData())==null?void 0:h.gridApi:null,a&&m.setValues(o.value),s.setState({title:n.value?e("sys.user.editUser"):e("sys.user.addUser")})}});return r(s),(a,p)=>(A(),_(w(t),null,{default:U(()=>[C(w(c))]),_:1}))}});export{J as _,E as s,Z as t};
