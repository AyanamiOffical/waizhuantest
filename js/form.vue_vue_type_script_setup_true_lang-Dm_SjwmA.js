var b=(a,n,m)=>new Promise((r,c)=>{var d=s=>{try{l(m.next(s))}catch(t){c(t)}},f=s=>{try{l(m.throw(s))}catch(t){c(t)}},l=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,f);l((m=m.apply(a,n)).next())});import{u as w}from"./form-CK_zT3Xn.js";import{b1 as p,ap as e,bp as N}from"./bootstrap-BWmjjFp9.js";import{g as x}from"./memberRank-Bfa7Fld-.js";import{s as u}from"./use-vben-form-67dA5BCn.js";import{k as I,V as M,O as g,Z as S,_,$ as F,x as A,U as v}from"../jse/index-index-DuhpPpLg.js";import C from"./index-CRapU7To.js";import{u as V}from"./use-modal-CjlieS99.js";const $=a=>p.post("/mms-api/member/list",a),D=a=>p.post("/mms-api/member/create",a),k=a=>p.post("/mms-api/member/update",a),G=a=>p.post("/mms-api/member/delete",a),Z={columns:[{type:"checkbox",width:60},{title:e("sys.login.username"),field:"username"},{title:e("sys.user.nickname"),field:"nickname"},{title:e("common.status"),field:"status",slots:{default:a=>I(C,{checked:a.row.status===1,onClick:()=>{const n=a.row.status===1?2:1;k({id:a.row.id,status:n}).then(()=>{a.row.status=n})}})}},{title:e("common.createTime"),field:"createdAt",formatter:"formatDateTime"}]},E={schema:[{fieldName:"username",label:e("sys.login.username"),component:"Input"},{fieldName:"nickname",label:e("sys.user.nickname"),component:"Input"},{fieldName:"mobile",label:e("sys.login.mobile"),component:"Input"},{fieldName:"email",label:e("sys.login.email"),component:"Input"}]},P={schema:[{fieldName:"avatar",label:e("sys.user.avatar"),component:"ImageUpload",componentProps:{accept:["png","jpeg","jpg"],maxSize:2,maxNumber:1,multiple:!1,provider:"cloud-default"}},{fieldName:"id",label:"ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"username",label:e("sys.login.username"),component:"Input",rules:u().max(50)},{fieldName:"nickname",label:e("sys.user.nickname"),component:"Input",rules:u().max(40)},{fieldName:"rankId",label:e("sys.member.rankId"),component:"ApiSelect",defaultValue:1,componentProps:{api:x,params:{page:1,pageSize:1e3},resultField:"data.data",labelField:"trans",valueField:"id"}},{fieldName:"expiredAt",label:e("sys.member.expiredAt"),component:"SimpleTimePicker",componentProps:{timeMode:"date"}},{fieldName:"mobile",label:e("sys.login.mobile"),component:"Input",rules:u().max(20).optional()},{fieldName:"email",label:e("sys.login.email"),component:"Input",rules:u().email()},{fieldName:"password",label:e("sys.login.password"),component:"Input",rules:u().min(6).max(100)},{fieldName:"status",label:e("common.status"),component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:e("common.on"),value:1},{label:e("common.off"),value:2}]},rules:"required"}]},H=M({name:"MemberForm",__name:"form",setup(a,{expose:n}){const m=g(),r=g(!1),c=g();function d(o){return b(this,null,function*(){const i=r.value?yield k(o):yield D(o);i.code===0&&(N.success(i.msg),c.value.reload())})}const[f,l]=w({handleSubmit:d,schema:[...P.schema],showDefaultActions:!1,layout:"vertical"}),[s,t]=V({fullscreenButton:!1,onCancel(){t.close()},onConfirm:()=>b(this,null,function*(){(yield l.validate()).valid&&(yield l.submitForm(),t.close())}),onOpenChange(o){var i,y,h;r.value=(i=t.getData())==null?void 0:i.isUpdate,m.value=o?((y=t.getData())==null?void 0:y.record)||{}:{},c.value=o?(h=t.getData())==null?void 0:h.gridApi:null,o&&l.setValues(m.value),t.setState({title:r.value?e("sys.member.editMember"):e("sys.member.addMember")})}});return n(t),(o,i)=>(_(),S(v(s),null,{default:F(()=>[A(v(f))]),_:1}))}});export{H as _,G as d,$ as g,E as s,Z as t};
