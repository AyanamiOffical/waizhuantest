var d=(a,m,i)=>new Promise((f,r)=>{var c=l=>{try{s(i.next(l))}catch(t){r(t)}},u=l=>{try{s(i.throw(l))}catch(t){r(t)}},s=l=>l.done?f(l.value):Promise.resolve(l.value).then(c,u);s((i=i.apply(a,m)).next())});import{u as w}from"./form-ZuhkTVCu.js";import{ap as e,cC as F,cD as S,bp as N}from"./bootstrap-_LeX4-bm.js";import{g as v}from"./fileTag-j4joOYU5.js";import{k as T,V as x,O as p,Z as y,_,$ as z,x as C,U as h}from"../jse/index-index-CCysr0kX.js";import{n as I,s as A}from"./use-vben-form-BJ1BG10c.js";import D from"./index-C_t4d1EK.js";import{u as k}from"./use-modal-OeyNsIFo.js";const L={columns:[{type:"checkbox",width:60},{title:e("fms.file.fileName"),field:"name"},{title:e("component.cropper.preview"),field:"publicPath",cellRender:{name:"CellImage"}},{title:e("fms.file.fileType"),field:"fileType",slots:{default:a=>{switch(a.row.fileType){case 2:return e("fms.file.image");case 3:return e("fms.file.video");case 4:return e("fms.file.audio");default:return e("fms.file.other")}}}},{title:e("fms.file.fileSize"),field:"size",slots:{default:a=>a.row.size>1073741824?`${(a.row.size/1073741824).toFixed(2)}GB`:a.row.size>1048576?`${(a.row.size/1048576).toFixed(2)}MB`:`${(a.row.size/1024).toFixed(2)}KB`}},{title:e("common.status"),field:"status",slots:{default:a=>T(D,{checked:a.row.status===1,onClick:()=>{const m=a.row.status===1?2:1;F(a.row.id,m).then(()=>{a.row.status=m})}})}},{title:e("common.createTime"),field:"createdAt",formatter:"formatDateTime"}]},Z={schema:[{fieldName:"fileType",label:e("fms.file.fileType"),rules:I().max(10).optional(),component:"Select",componentProps:{options:[{label:e("common.all"),value:0},{label:e("fms.file.other"),value:1},{label:e("fms.file.image"),value:2},{label:e("fms.file.video"),value:3},{label:e("fms.file.audio"),value:4}]}},{fieldName:"fileName",label:e("fms.file.fileName"),component:"Input",rules:A().max(50).optional()},{fieldName:"period",label:e("common.createTime"),component:"Input"},{fieldName:"fileTagIds",label:e("fms.tag.tag"),component:"ApiSelect",componentProps:{api:v,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"name",valueField:"id",multiple:!0}}]},B={schema:[{fieldName:"id",label:"ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"name",label:e("fms.file.fileName"),component:"Input"},{fieldName:"tagIds",label:e("fms.tag.tag"),component:"ApiSelect",componentProps:{api:v,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"name",valueField:"id",multiple:!0}}]},j=x({name:"FileForm",__name:"form",setup(a,{expose:m}){const i=p(),f=p(!1),r=p();function c(o){return d(this,null,function*(){const n=yield S(o);n.code===0&&(N.success(n.msg),r.value.reload())})}const[u,s]=w({handleSubmit:c,schema:[...B.schema],showDefaultActions:!1,layout:"vertical"}),[l,t]=k({fullscreenButton:!1,onCancel(){t.close()},onConfirm:()=>d(this,null,function*(){(yield s.validate()).valid&&(yield s.submitForm(),t.close())}),onOpenChange(o){var n,g,b;f.value=(n=t.getData())==null?void 0:n.isUpdate,i.value=o?((g=t.getData())==null?void 0:g.record)||{}:{},r.value=o?(b=t.getData())==null?void 0:b.gridApi:null,o&&s.setValues(i.value),t.setState({title:f.value?e("fms.file.editFile"):e("fms.file.addFile")})}});return m(t),(o,n)=>(_(),y(h(l),null,{default:z(()=>[C(h(u))]),_:1}))}});export{j as _,Z as s,L as t};
