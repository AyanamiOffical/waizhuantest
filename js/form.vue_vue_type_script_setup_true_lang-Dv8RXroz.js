var f=(l,m,i)=>new Promise((d,r)=>{var u=t=>{try{s(i.next(t))}catch(a){r(a)}},c=t=>{try{s(i.throw(t))}catch(a){r(a)}},s=t=>t.done?d(t.value):Promise.resolve(t.value).then(u,c);s((i=i.apply(l,m)).next())});import{u as h}from"./form-CWWYCqXo.js";import{ap as e,c0 as g,c1 as I,bp as S}from"./bootstrap-B-VSIAtm.js";import{g as w}from"./cloudFileTag-ViNpjJXD.js";import{g as N}from"./storageProvider-BkPDd5J6.js";import C from"./index-BMZQRmWB.js";import{k as z,V as y,O as p,Z as _,_ as T,$ as x,x as A,U as v}from"../jse/index-index-fT_vxJqM.js";import{u as P}from"./use-modal-BhR4F9RI.js";const L={columns:[{type:"checkbox",width:60},{title:e("fms.cloudFile.name"),field:"name"},{title:e("component.cropper.preview"),field:"url",cellRender:{name:"CellImage"}},{title:e("fms.cloudFile.size"),field:"size",slots:{default:l=>l.row.size>1073741824?`${(l.row.size/1073741824).toFixed(2)}GB`:l.row.size>1048576?`${(l.row.size/1048576).toFixed(2)}MB`:`${(l.row.size/1024).toFixed(2)}KB`}},{title:e("fms.cloudFile.fileType"),field:"fileType",slots:{default:l=>{switch(l.row.fileType){case 2:return e("fms.file.image");case 3:return e("fms.file.video");case 4:return e("fms.file.audio");default:return e("fms.file.other")}}}},{title:e("common.status"),field:"state",slots:{default:l=>z(C,{checked:l.row.state,onClick:()=>{const m=!l.row.state;g({id:l.row.id,state:m,providerId:l.row.providerId}).then(()=>{l.row.state=m})}})}},{title:e("common.createTime"),field:"createdAt",formatter:"formatDateTime"}]},K={schema:[{fieldName:"name",label:e("fms.cloudFile.name"),component:"Input"},{fieldName:"providerId",label:e("fms.cloudFile.providerId"),component:"Input"},{fieldName:"tagIds",label:e("fms.tag.tag"),component:"ApiSelect",componentProps:{api:w,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"name",valueField:"id",multiple:!0}},{fieldName:"fileType",label:e("fms.cloudFile.fileType"),defaultValue:0,component:"Select",componentProps:{options:[{label:e("common.all"),value:0},{label:e("fms.file.other"),value:1},{label:e("fms.file.image"),value:2},{label:e("fms.file.video"),value:3},{label:e("fms.file.audio"),value:4}]}}]},V={schema:[{fieldName:"id",label:"ID",component:"Input",dependencies:{show:!1,triggerFields:["id"]}},{fieldName:"name",label:e("fms.cloudFile.name"),component:"Input"},{fieldName:"url",label:e("fms.cloudFile.url"),component:"Input"},{fieldName:"size",label:e("fms.cloudFile.size"),component:"InputNumber",componentProps:{class:"w-full"}},{fieldName:"fileType",label:e("fms.cloudFile.fileType"),defaultValue:0,component:"Select",componentProps:{options:[{label:e("common.all"),value:0},{label:e("fms.file.other"),value:1},{label:e("fms.file.image"),value:2},{label:e("fms.file.video"),value:3},{label:e("fms.file.audio"),value:4}],class:"w-full"}},{fieldName:"userId",label:e("fms.cloudFile.userId"),component:"Input"},{fieldName:"providerId",label:e("fms.cloudFile.providerId"),component:"ApiSelect",componentProps:{api:N,params:{page:1,pageSize:1e3},resultField:"data.data",labelField:"name",valueField:"id"}},{fieldName:"tagIds",label:e("fms.tag.tag"),component:"ApiSelect",componentProps:{api:w,params:{page:1,pageSize:1e3,name:""},resultField:"data.data",labelField:"name",valueField:"id",multiple:!0}},{fieldName:"state",label:e("fms.cloudFile.state"),component:"RadioButtonGroup",defaultValue:!0,componentProps:{options:[{label:e("common.on"),value:!0},{label:e("common.off"),value:!1}]}}]},Z=y({name:"CloudFileForm",__name:"form",setup(l,{expose:m}){const i=p(),d=p(!1),r=p();function u(o){return f(this,null,function*(){const n=d.value?yield g(o):yield I(o);n.code===0&&(S.success(n.msg),r.value.reload())})}const[c,s]=h({handleSubmit:u,schema:[...V.schema],showDefaultActions:!1,layout:"vertical"}),[t,a]=P({fullscreenButton:!1,onCancel(){a.close()},onConfirm:()=>f(this,null,function*(){(yield s.validate()).valid&&(yield s.submitForm(),a.close())}),onOpenChange(o){var n,F,b;d.value=(n=a.getData())==null?void 0:n.isUpdate,i.value=o?((F=a.getData())==null?void 0:F.record)||{}:{},r.value=o?(b=a.getData())==null?void 0:b.gridApi:null,o&&s.setValues(i.value),a.setState({title:d.value?e("fms.cloudFile.editCloudFile"):e("fms.cloudFile.addCloudFile")})}});return m(a),(o,n)=>(T(),_(v(t),null,{default:x(()=>[A(v(c))]),_:1}))}});export{Z as _,K as s,L as t};
