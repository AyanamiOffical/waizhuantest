var Z=Object.defineProperty;var S=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var V=(c,t,a)=>t in c?Z(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a,$=(c,t)=>{for(var a in t||(t={}))H.call(t,a)&&V(c,a,t[a]);if(S)for(var a of S(t))J.call(t,a)&&V(c,a,t[a]);return c};var d=(c,t,a)=>new Promise((f,m)=>{var y=r=>{try{h(a.next(r))}catch(u){m(u)}},w=r=>{try{h(a.throw(r))}catch(u){m(u)}},h=r=>r.done?f(r.value):Promise.resolve(r.value).then(y,w);h((a=a.apply(c,t)).next())});import{ap as n,ce as K,bp as Q,cf as C,cg as X,aW as Y,ch as ee,ci as oe}from"./bootstrap-B-VSIAtm.js";import{V as te,O as p,k as ae,bL as le,Z as ne,_ as ie,$ as i,x as s,U as o,a5 as k,a6 as b,as as P,ar as se}from"../jse/index-index-fT_vxJqM.js";import{r as ce}from"./chunk-BZNENX2T-BoCj3v1U.js";import{_ as re,u as ue}from"./TableAction.vue_vue_type_style_index_0_lang-CJC400sX.js";import{g as de}from"./storageProvider-BkPDd5J6.js";import{_ as me}from"./UploadDragger.vue_vue_type_script_setup_true_lang-BR_yCR_s.js";import{_ as pe,t as fe,s as he}from"./form.vue_vue_type_script_setup_true_lang-Dv8RXroz.js";import{I as ge}from"./index-D4GcylDq.js";import{_ as ve}from"./page.vue_vue_type_script_setup_true_lang-DTCuaPOc.js";import{u as _}from"./use-modal-BhR4F9RI.js";import"./index-DrXurIMi.js";import"./form-CWWYCqXo.js";import"./use-vben-form-m2hWlrgt.js";import"./render-content.vue_vue_type_script_lang-CD9tW6pI.js";import"./index-BMZQRmWB.js";import"./index-Bw1tMpvo.js";import"./cloudFileTag-ViNpjJXD.js";const Ce={controls:"",height:"720",width:"1280"},ke=["src"],Ie=te({name:"CloudFileManagement",__name:"index",setup(c){const t=p(""),[a,f]=_({connectedComponent:pe}),m=p(!1),y={checkboxChange(e){m.value=e.$table.getCheckboxRecords().length>0},checkboxAll(e){m.value=e.$table.getCheckboxRecords().length>0}},w={collapsed:!1,schema:[...he.schema],showCollapseButton:!0,submitOnEnter:!1},h={checkboxConfig:{highlight:!0},toolbarConfig:{slots:{buttons:"toolbar-buttons"}},columns:[...fe.columns,{title:n("common.action"),fixed:"right",field:"action",slots:{default:({row:e})=>ae(re,{actions:[{type:"link",icon:"ant-design:cloud-download-outlined",tooltip:n("fms.file.download"),onClick:W.bind(null,e)},{type:"link",icon:"ant-design:copy-outlined",tooltip:n("fms.file.copyURL"),onClick:q.bind(null,e)},{type:"link",icon:"clarity:note-edit-line",tooltip:n("common.edit"),onClick:F.bind(null,e)},{icon:"ant-design:delete-outlined",type:"link",color:"error",tooltip:n("common.delete"),popConfirm:{title:n("common.deleteConfirm"),placement:"left",confirm:L.bind(null,[e.id])}}]})}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(B,je)=>d(this,[B,je],function*({page:e},l){return(yield oe($({page:e.currentPage,pageSize:e.pageSize},l))).data})}}},[r,u]=ue({formOptions:w,gridOptions:h,gridEvents:y});function F(e){ce(e)?f.setData({record:e,isUpdate:!0,gridApi:u}):f.setData({record:null,isUpdate:!1,gridApi:u}),f.open()}function A(){ee.confirm({title:n("common.deleteConfirm"),onOk(){return d(this,null,function*(){const l=u.grid.getCheckboxRecords().map(B=>B.id);L(l)})}})}function L(e){return d(this,null,function*(){(yield K({ids:e})).code===0&&(yield u.reload(),m.value=!1)})}const[E,x]=_({fullscreenButton:!1,onCancel(){x.close()},onConfirm:()=>d(this,null,function*(){x.close()}),onOpenChange(){},title:n("component.upload.upload")});function I(e){for(const l of e)if(l.isDefault){t.value=l.label;break}}const O=p(""),M=p(""),U=p(""),R=p(""),D=p(""),[N,g]=_({fullscreenButton:!1,onCancel(){g.close()},onConfirm:()=>d(this,null,function*(){g.close()}),onOpenChange(){g.setState({title:U.value})},title:U.value});function T(){const e=document.createElement("a");e.href=M.value,e.download=D.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),g.close()}const[j,v]=_({fullscreenButton:!1,onCancel(){v.close()},onConfirm:()=>d(this,null,function*(){v.close()}),onOpenChange(){v.setState({title:R.value})}});function z(){const e=document.createElement("a");e.href=O.value,e.download=D.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),v.close()}const{copy:G}=le();function q(e){G(e.publicPath),Q.success(n("common.successful"))}function W(e){return d(this,null,function*(){if(D.value=e.name,e.fileType===2)R.value=e.name,O.value=e.url,v.open();else if(e.fileType===3)U.value=e.name,M.value=e.url,g.open();else{const l=document.createElement("a");l.href=e.url,l.download=e.name,l.click(),l.remove(),URL.revokeObjectURL(l.href)}})}return(e,l)=>(ie(),ne(o(ve),{"auto-content-height":""},{default:i(()=>[s(o(j),null,{footer:i(()=>[s(o(C),{key:"download",type:"primary",onClick:z},{default:i(()=>[k(b(o(n)("fms.file.download")),1)]),_:1})]),default:i(()=>[s(o(ge),{src:O.value,style:{},width:"100%"},null,8,["src"])]),_:1}),s(o(N),null,{footer:i(()=>[s(o(C),{key:"download",type:"primary",onClick:T},{default:i(()=>[k(b(o(n)("fms.file.download")),1)]),_:1})]),default:i(()=>[P("video",Ce,[P("source",{src:M.value,type:"video/mp4"},null,8,ke)])]),_:1}),s(o(E),null,{default:i(()=>[s(o(X),{value:t.value,"onUpdate:value":l[0]||(l[0]=B=>t.value=B),api:o(de),multiple:!1,params:{page:1,pageSize:1e3},class:"w-32","label-field":"name","result-field":"data.data","value-field":"name",onOptionsChange:I},null,8,["value","api"]),s(o(me),{provider:t.value,class:"mt-2"},null,8,["provider"])]),_:1}),s(o(a)),s(o(r),null,{"toolbar-buttons":i(()=>[se(s(o(C),{danger:"",type:"primary",onClick:A},{default:i(()=>[k(b(o(n)("common.delete")),1)]),_:1},512),[[Y,m.value]])]),"toolbar-tools":i(()=>[s(o(C),{type:"primary",onClick:o(x).open},{default:i(()=>[k(b(o(n)("component.upload.upload")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}))}});export{Ie as default};
