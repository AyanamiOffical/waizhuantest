var W=Object.defineProperty;var $=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var F=(s,a,o)=>a in s?W(s,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[a]=o,S=(s,a)=>{for(var o in a||(a={}))Z.call(a,o)&&F(s,o,a[o]);if($)for(var o of $(a))H.call(a,o)&&F(s,o,a[o]);return s};var d=(s,a,o)=>new Promise((u,b)=>{var x=l=>{try{f(o.next(l))}catch(h){b(h)}},R=l=>{try{f(o.throw(l))}catch(h){b(h)}},f=l=>l.done?u(l.value):Promise.resolve(l.value).then(x,R);f((o=o.apply(s,a)).next())});import{ap as n,cE as J,bp as K,cF as Q,cf as _,aW as X,ch as Y,cG as ee}from"./bootstrap-BWmjjFp9.js";import{V as oe,O as p,k as te,bL as ae,Z as ne,_ as le,$ as i,x as c,U as t,a5 as y,a6 as w,as as j,ar as ie}from"../jse/index-index-DuhpPpLg.js";import{r as ce}from"./chunk-BZNENX2T-BoCj3v1U.js";import{_ as se,u as re}from"./TableAction.vue_vue_type_style_index_0_lang-BqLOqCja.js";import{_ as de}from"./UploadDragger.vue_vue_type_script_setup_true_lang-b_O17bCP.js";import{_ as ue,t as me,s as pe}from"./form.vue_vue_type_script_setup_true_lang-DUpk4L69.js";import{I as fe}from"./index-BqPUBnbf.js";import{_ as he}from"./page.vue_vue_type_script_setup_true_lang-M_Vyrb2o.js";import{u as U}from"./use-modal-CjlieS99.js";import"./index-Cy4jNNSy.js";import"./form-CK_zT3Xn.js";import"./use-vben-form-67dA5BCn.js";import"./render-content.vue_vue_type_script_lang-CRSyYege.js";import"./index-CRapU7To.js";import"./index-B9GNlf0b.js";import"./fileTag-B8izDkDR.js";const ge={controls:"",height:"720",width:"1280"},ve=["src"],je=oe({name:"FileManagement",__name:"index",setup(s){const[a,o]=U({connectedComponent:ue}),u=p(!1),b={checkboxChange(e){u.value=e.$table.getCheckboxRecords().length>0},checkboxAll(e){u.value=e.$table.getCheckboxRecords().length>0}},x={collapsed:!1,schema:[...pe.schema],showCollapseButton:!0,submitOnEnter:!1},R={checkboxConfig:{highlight:!0},toolbarConfig:{slots:{buttons:"toolbar-buttons"}},columns:[...me.columns,{title:n("common.action"),fixed:"right",field:"action",slots:{default:({row:e})=>te(se,{actions:[{type:"link",icon:"ant-design:cloud-download-outlined",tooltip:n("fms.file.download"),onClick:q.bind(null,e)},{type:"link",icon:"ant-design:copy-outlined",tooltip:n("fms.file.copyURL"),onClick:z.bind(null,e)},{type:"link",icon:"clarity:note-edit-line",tooltip:n("common.edit"),onClick:h.bind(null,e)},{icon:"ant-design:delete-outlined",type:"link",color:"error",tooltip:n("common.delete"),popConfirm:{title:n("common.deleteConfirm"),placement:"left",confirm:D.bind(null,[e.id])}}]})}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(k,C)=>d(this,[k,C],function*({page:e},r){return(yield ee(S({page:e.currentPage,pageSize:e.pageSize},r))).data})}}},[f,l]=re({formOptions:x,gridOptions:R,gridEvents:b});function h(e){ce(e)?o.setData({record:e,isUpdate:!0,gridApi:l}):o.setData({record:null,isUpdate:!1,gridApi:l}),o.open()}function P(){Y.confirm({title:n("common.deleteConfirm"),onOk(){return d(this,null,function*(){const r=l.grid.getCheckboxRecords().map(k=>k.id);D(r)})}})}function D(e){return d(this,null,function*(){(yield J({ids:e})).code===0&&(yield l.reload(),u.value=!1)})}const[A,L]=U({fullscreenButton:!1,onCancel(){L.close()},onConfirm:()=>d(this,null,function*(){L.close()}),onOpenChange(){},title:n("component.upload.upload")}),O=p(""),M=p(""),B=p(""),V=p(""),m=p(""),[E,g]=U({fullscreenButton:!1,onCancel(){g.close()},onConfirm:()=>d(this,null,function*(){g.close()}),onOpenChange(){g.setState({title:B.value})},title:B.value});function I(){const e=document.createElement("a");e.href=M.value,e.download=m.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),g.close()}const[N,v]=U({fullscreenButton:!1,onCancel(){v.close()},onConfirm:()=>d(this,null,function*(){v.close()}),onOpenChange(){v.setState({title:V.value})}});function T(){const e=document.createElement("a");e.href=O.value,e.download=m.value,e.click(),e.remove(),URL.revokeObjectURL(e.href),v.close()}const{copy:G}=ae();function z(e){G(e.publicPath),K.success(n("common.successful"))}function q(e){return d(this,null,function*(){const r=yield Q(e.id),k=r.type.split("/")[0];if(m.value=`${e.name}.${e.path.split(".")[1]}`,k==="image")V.value=m.value,O.value=URL.createObjectURL(r),v.open();else if(k==="video")B.value=m.value,M.value=URL.createObjectURL(r),g.open();else{const C=document.createElement("a");C.href=URL.createObjectURL(r),C.download=m.value,C.click(),C.remove(),URL.revokeObjectURL(C.href)}})}return(e,r)=>(le(),ne(t(he),{"auto-content-height":""},{default:i(()=>[c(t(N),null,{footer:i(()=>[c(t(_),{key:"download",type:"primary",onClick:T},{default:i(()=>[y(w(t(n)("fms.file.download")),1)]),_:1})]),default:i(()=>[c(t(fe),{src:O.value,style:{},width:"100%"},null,8,["src"])]),_:1}),c(t(E),null,{footer:i(()=>[c(t(_),{key:"download",type:"primary",onClick:I},{default:i(()=>[y(w(t(n)("fms.file.download")),1)]),_:1})]),default:i(()=>[j("video",ge,[j("source",{src:M.value,type:"video/mp4"},null,8,ve)])]),_:1}),c(t(a)),c(t(A),null,{default:i(()=>[c(t(de))]),_:1}),c(t(f),null,{"toolbar-buttons":i(()=>[ie(c(t(_),{danger:"",type:"primary",onClick:P},{default:i(()=>[y(w(t(n)("common.delete")),1)]),_:1},512),[[X,u.value]])]),"toolbar-tools":i(()=>[c(t(_),{type:"primary",onClick:t(L).open},{default:i(()=>[y(w(t(n)("component.upload.upload")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}))}});export{je as default};
