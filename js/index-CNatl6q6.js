var L=Object.defineProperty;var D=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var x=(r,o,t)=>o in r?L(r,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[o]=t,w=(r,o)=>{for(var t in o||(o={}))z.call(o,t)&&x(r,t,o[t]);if(D)for(var t of D(o))I.call(o,t)&&x(r,t,o[t]);return r};var d=(r,o,t)=>new Promise((h,g)=>{var b=l=>{try{c(t.next(l))}catch(p){g(p)}},u=l=>{try{c(t.throw(l))}catch(p){g(p)}},c=l=>l.done?h(l.value):Promise.resolve(l.value).then(b,u);c((t=t.apply(r,o)).next())});import{ap as n,df as K,bp as v,cf as F,aW as N,cH as T,ch as E,dg as G}from"./bootstrap-DXVvTFoS.js";import{r as j}from"./chunk-BZNENX2T-BoCj3v1U.js";import{_ as q,u as H}from"./TableAction.vue_vue_type_style_index_0_lang-CJNs7Aso.js";import{g as P}from"./department-j6s1zlQm.js";import{l as W}from"./token-Dff-x2GF.js";import{_ as Y,t as Z,s as J}from"./form.vue_vue_type_script_setup_true_lang-CtRYNNq2.js";import{_ as S}from"./page.vue_vue_type_script_setup_true_lang-B-FBxrtp.js";import{C as Q}from"./index-Bg4plDRT.js";import{V as X,O as C,Y as ee,k as te,Z as oe,_ as ae,$ as s,x as i,U as a,a5 as M,a6 as O,ar as ne}from"../jse/index-index-BpfZjsfB.js";import{u as re}from"./use-modal-DdHEjpwi.js";import{C as U,R as se}from"./index-Dq0om8A1.js";import{T as ie}from"./index-UmVT99-3.js";import"./index-BViELZQP.js";import"./form-BY5gWF-X.js";import"./use-vben-form-F13RO0jS.js";import"./render-content.vue_vue_type_script_lang-Dm6NPG3G.js";import"./index-BH_3AJJk.js";import"./index-CxJQESyl.js";import"./index-2RmDDPPU.js";import"./position-RojQfUU6.js";import"./role-CtmvB8x1.js";const $e=X({name:"UserManagement",__name:"index",setup(r){const o=C(),t=C();function h(){return d(this,null,function*(){const e=yield P({page:1,pageSize:1e3});o.value=T(e.data.data,{labelField:"trans",valueField:"id",idKeyField:"id",childrenKeyField:"children",parentKeyField:"parentId"})})}function g(e){t.value=e[0],m.reload()}ee(()=>{h()});const[b,u]=re({connectedComponent:Y}),c=C(!1),l={checkboxChange(e){c.value=e.$table.getCheckboxRecords().length>0},checkboxAll(e){c.value=e.$table.getCheckboxRecords().length>0}},p={collapsed:!1,schema:[...J.schema],showCollapseButton:!0,submitOnEnter:!1},$={checkboxConfig:{highlight:!0},toolbarConfig:{slots:{buttons:"toolbar-buttons"}},columns:[...Z.columns,{title:n("common.action"),fixed:"right",field:"action",slots:{default:({row:e})=>te(q,{actions:[{label:"",type:"link",size:"small",tooltip:n("common.edit"),icon:"clarity:note-edit-line",onClick:y.bind(null,e)},{icon:"bx:log-out-circle",type:"link",color:"error",tooltip:n("sys.user.forceLoggingOut"),popConfirm:{title:n("sys.user.forceLoggingOut"),placement:"left",confirm:V.bind(null,e)}},{icon:"ant-design:delete-outlined",type:"link",color:"error",tooltip:n("common.delete"),popConfirm:{title:n("common.deleteConfirm"),placement:"left",confirm:k.bind(null,[e.id])}}]})}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(A,_)=>d(this,[A,_],function*({page:e},f){return(yield G(w({page:e.currentPage,pageSize:e.pageSize,departmentId:t.value},f))).data})}}},[B,m]=H({formOptions:p,gridOptions:$,gridEvents:l});function y(e){j(e)?u.setData({record:e,isUpdate:!0,gridApi:m}):u.setData({record:null,isUpdate:!1,gridApi:m}),u.open()}function R(){E.confirm({title:n("common.deleteConfirm"),onOk(){return d(this,null,function*(){if(m.grid.getCheckboxRecords().some(_=>_.nickname==="admin")){v.warn(n("common.notAllowDeleteAdminData"));return}const A=m.grid.getCheckboxRecords().map(_=>_.id);k(A)})}})}function k(e){return d(this,null,function*(){(yield K({ids:e})).code===0&&(yield m.reload(),c.value=!1)})}function V(e){return d(this,null,function*(){(yield W(e.id)).code===0&&v.success(n("common.successful"))})}return(e,f)=>(ae(),oe(a(se),null,{default:s(()=>[i(a(U),{span:5},{default:s(()=>[i(a(S),{"auto-content-height":""},{default:s(()=>[i(a(Q),{title:a(n)("sys.department.userDepartment"),style:{height:"100%"}},{default:s(()=>[i(a(ie),{"tree-data":o.value,"block-node":"",onSelect:g},null,8,["tree-data"])]),_:1},8,["title"])]),_:1})]),_:1}),i(a(U),{span:19},{default:s(()=>[i(a(S),{"auto-content-height":""},{default:s(()=>[i(a(b)),i(a(B),null,{"toolbar-buttons":s(()=>[ne(i(a(F),{danger:"",type:"primary",onClick:R},{default:s(()=>[M(O(a(n)("common.delete")),1)]),_:1},512),[[N,c.value]])]),"toolbar-tools":s(()=>[i(a(F),{type:"primary",onClick:y},{default:s(()=>[M(O(a(n)("sys.user.addUser")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{$e as default};
