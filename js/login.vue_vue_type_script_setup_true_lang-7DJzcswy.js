var v=(P,c,u)=>new Promise((g,d)=>{var p=n=>{try{i(u.next(n))}catch(h){d(h)}},s=n=>{try{i(u.throw(n))}catch(h){d(h)}},i=n=>n.done?g(n.value):Promise.resolve(n.value).then(p,s);i((u=u.apply(P,c)).next())});import{b as N,g as E,a as q}from"./captcha-CkwysULF.js";import{o as x}from"./oauthProvider-ilaFJzyB.js";import{ap as a,b2 as A,b3 as O,aq as D,ar as B,aZ as U,b4 as j,b5 as K,u as Q}from"./bootstrap-BWmjjFp9.js";import{I as Y}from"./index-BqPUBnbf.js";import{T as Z}from"./auth-title-BVzbub5R.js";import{V as F,ak as L,_ as r,as as b,a6 as m,U as o,F as z,au as G,Z as $,$ as w,x as S,am as J,J as R,O as C,Y as W,X as _,af as f,a5 as y,aW as X,k as H}from"../jse/index-index-DuhpPpLg.js";import{u as ee,_ as te,s as I}from"./use-vben-form-67dA5BCn.js";const ae={class:"w-full sm:mx-auto md:max-w-md"},oe={class:"mt-4 flex items-center justify-between"},ne={class:"text-muted-foreground text-center text-xs uppercase"},se={class:"mt-4 flex flex-wrap justify-center"},ie=F({name:"ThirdPartyLogin",__name:"third-party-login",props:{iconList:{type:Array,default:[{icon:"icon-park-outline:github",oauthProvider:"github"}]}},emits:["oauthLogin"],setup(P,{emit:c}){const u=P,g=c;function d(p){g("oauthLogin",p)}return(p,s)=>(r(),L("div",ae,[b("div",oe,[s[0]||(s[0]=b("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1)),b("span",ne,m(o(a)("authentication.thirdPartyLogin")),1),s[1]||(s[1]=b("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1))]),b("div",se,[(r(!0),L(z,null,G(u.iconList,i=>(r(),$(o(A),{key:i.icon,class:"mb-3",onClick:n=>d(i.oauthProvider)},{default:w(()=>[S(o(O),{icon:i.icon},null,8,["icon"])]),_:2},1032,["onClick"]))),128))])]))}}),re=["onKeydown"],le={class:"text-muted-foreground"},ce={key:0,class:"mb-6 flex justify-between"},ue={class:"flex-center"},de={key:1,class:"mb-2 mt-4 flex items-center justify-between"},me={key:0,class:"mt-3 text-center text-sm"},pe=F({name:"AuthenticationLogin",__name:"login",props:{formSchema:{default:()=>[]},codeLoginPath:{default:"/auth/code-login"},forgetPasswordPath:{default:"/auth/forget-password"},loading:{type:Boolean,default:!1},qrCodeLoginPath:{default:"/auth/qrcode-login"},registerPath:{default:"/auth/register"},showCodeLogin:{type:Boolean,default:!0},showForgetPassword:{type:Boolean,default:!0},showQrcodeLogin:{type:Boolean,default:!0},showRegister:{type:Boolean,default:!0},showRememberMe:{type:Boolean,default:!0},showThirdPartyLogin:{type:Boolean,default:!0},thirdPartyProviderList:{},subTitle:{default:""},title:{default:""},submitButtonText:{default:""}},emits:["submit","oauthLogin"],setup(P,{expose:c,emit:u}){const g=P,d=u,[p,s]=ee(J({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:R(()=>g.formSchema),showDefaultActions:!1})),i=D(),n=`REMEMBER_ME_USERNAME_${location.hostname}`,h=localStorage.getItem(n)||"",T=C(!!h);function M(){return v(this,null,function*(){const{valid:t}=yield s.validate(),e=yield s.getValues();t&&(localStorage.setItem(n,T.value?e==null?void 0:e.username:""),d("submit",e))})}function k(t){i.push(t)}W(()=>{h&&s.setFieldValue("username",h)}),c({getFormApi:()=>s});function V(t){d("oauthLogin",t)}return(t,e)=>(r(),L("div",{onKeydown:U(j(M,["prevent"]),["enter"])},[_(t.$slots,"title",{},()=>[S(Z,null,{desc:w(()=>[b("span",le,[_(t.$slots,"subTitle",{},()=>[y(m(t.subTitle||o(a)("authentication.loginSubtitle")),1)])])]),default:w(()=>[_(t.$slots,"title",{},()=>[y(m(t.title||`${o(a)("authentication.welcomeBack")} 👋🏻`),1)])]),_:3})]),S(o(p)),t.showRememberMe||t.showForgetPassword?(r(),L("div",ce,[b("div",ue,[t.showRememberMe?(r(),$(o(te),{key:0,checked:T.value,"onUpdate:checked":e[0]||(e[0]=l=>T.value=l),name:"rememberMe"},{default:w(()=>[y(m(o(a)("authentication.rememberMe")),1)]),_:1},8,["checked"])):f("",!0)]),t.showForgetPassword?(r(),L("span",{key:0,class:"vben-link text-sm font-normal",onClick:e[1]||(e[1]=l=>k(t.forgetPasswordPath))},m(o(a)("authentication.forgetPassword")),1)):f("",!0)])):f("",!0),S(o(B),{class:X([{"cursor-wait":t.loading},"w-full"]),loading:t.loading,"aria-label":"login",onClick:M},{default:w(()=>[y(m(t.submitButtonText||o(a)("common.login")),1)]),_:1},8,["class","loading"]),t.showCodeLogin||t.showQrcodeLogin?(r(),L("div",de,[t.showCodeLogin?(r(),$(o(B),{key:0,class:"w-1/2",variant:"outline",onClick:e[2]||(e[2]=l=>k(t.codeLoginPath))},{default:w(()=>[y(m(o(a)("authentication.mobileLogin")),1)]),_:1})):f("",!0),t.showQrcodeLogin?(r(),$(o(B),{key:1,class:"ml-4 w-1/2",variant:"outline",onClick:e[3]||(e[3]=l=>k(t.qrCodeLoginPath))},{default:w(()=>[y(m(o(a)("authentication.qrcodeLogin")),1)]),_:1})):f("",!0)])):f("",!0),_(t.$slots,"third-party-login",{},()=>[t.showThirdPartyLogin?(r(),$(ie,{key:0,"icon-list":g.thirdPartyProviderList,onOauthLogin:V},null,8,["icon-list"])):f("",!0)]),_(t.$slots,"to-register",{},()=>[t.showRegister?(r(),L("div",me,[y(m(o(a)("authentication.accountTip"))+" ",1),b("span",{class:"vben-link text-sm font-normal",onClick:e[4]||(e[4]=l=>k(t.registerPath))},m(o(a)("authentication.createAccount")),1)])):f("",!0)])],40,re))}}),Te=F({name:"Login",__name:"login",setup(P){const c=K(),{isDark:u}=Q(),g=[{label:a("sys.login.captcha"),value:"captcha"},{label:a("sys.login.mobile"),value:"mobile"},{label:a("sys.login.email"),value:"email"}],d=C(""),p=C(""),s=C(""),i=C("");function n(){return v(this,null,function*(){const e=yield N();e.code===0&&(p.value=e.data.captchaId,d.value=e.data.imgPath)})}n();function h(){return v(this,null,function*(){return s.value==="email"?(yield E({email:i.value})).code===0:(yield q({phoneNumber:i.value})).code===0})}const T=C(""),M=R(()=>[{component:"VbenSelect",componentProps:{options:g},label:"Login Type",fieldName:"selectLoginType",rules:I().optional().default("captcha"),formItemClass:"col-span-2 items-baseline",dependencies:{triggerFields:["selectLoginType"],trigger(e,l){s.value=e.selectLoginType}}},{component:"VbenInput",componentProps:{placeholder:a("authentication.usernameTip")},fieldName:"username",label:a("authentication.username"),rules:I().min(1,{message:a("authentication.usernameTip")}),dependencies:{if(e){return e.selectLoginType==="captcha"},triggerFields:["selectLoginType"]},formItemClass:"col-span-2 items-baseline"},{component:"VbenInput",componentProps:{placeholder:T},label:"Target",fieldName:"target",dependencies:{trigger(e,l){T.value=e.selectLoginType==="email"?a("sys.login.emailPlaceholder"):a("sys.login.mobilePlaceholder"),i.value=e.target},if(e){return e.selectLoginType!=="captcha"},triggerFields:["selectLoginType","target"]},formItemClass:"col-span-2 items-baseline"},{component:"VbenInputPassword",componentProps:{placeholder:a("authentication.password")},dependencies:{if(e){return e.selectLoginType==="captcha"},triggerFields:["selectLoginType"]},fieldName:"password",label:a("authentication.password"),rules:I().min(6,{message:a("authentication.passwordTip")}),formItemClass:"col-span-2 items-baseline"},{fieldName:"captcha",label:a("authentication.password"),dependencies:{if(e){return e.selectLoginType==="captcha"},triggerFields:["selectLoginType"]},component:"VbenInput",componentProps:{maxlength:5,placeholder:a("sys.login.smsPlaceholder")},formItemClass:"col-span-1 items-baseline",rules:I().length(5,{message:a("sys.login.captchaRequired")}).max(5)},{fieldName:"captchaImg",component:H(Y),componentProps:{src:d.value,width:120,height:40,preview:!1,onClick:n,style:{backgroundColor:u.value?"#eee":"transparent"}},formItemClass:"col-span-1 items-baseline",dependencies:{if(e){return e.selectLoginType==="captcha"},triggerFields:["selectLoginType"]}},{component:"VbenPinInput",componentProps:{createText:e=>e>0?a("authentication.sendText",[e]):a("authentication.sendCode"),placeholder:a("authentication.code"),codeLength:5,handleSendCode:h},dependencies:{if(e){return e.selectLoginType!=="captcha"},triggerFields:["selectLoginType"]},fieldName:"captchaVerified",label:a("authentication.code"),rules:I().length(5,{message:a("sys.login.captchaRequired")}).max(5),formItemClass:"col-span-2 items-baseline"}]);function k(e){return v(this,null,function*(){switch(e.selectLoginType){case"captcha":{c.authLogin({password:e.password,username:e.username,captcha:e.captcha,captchaId:p.value},"captcha").then(()=>{}).catch(()=>{n()});break}case"email":{c.authLogin({captcha:e.captchaVerified,email:e.target},"email").then(()=>{}).catch(()=>{n()});break}case"mobile":{c.authLogin({captcha:e.captchaVerified,phoneNumber:e.target},"mobile").then(()=>{}).catch(()=>{n()});break}}})}const V=[{icon:"icon-park-outline:github",oauthProvider:"github"},{icon:"mingcute:google-fill",oauthProvider:"google"}];function t(e){return v(this,null,function*(){const l=yield x({state:`${new Date().getMilliseconds()}-${e}`,provider:e});l.code===0&&window.open(l.data.URL)})}return(e,l)=>(r(),$(o(pe),{"form-schema":M.value,loading:o(c).loginLoading,"show-code-login":!1,"show-qrcode-login":!1,"third-party-provider-list":V,onOauthLogin:t,onSubmit:k},null,8,["form-schema","loading"]))}});export{Te as _};
