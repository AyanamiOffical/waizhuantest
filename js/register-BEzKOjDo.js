var b=(T,r,i)=>new Promise((d,m)=>{var g=o=>{try{l(i.next(o))}catch(t){m(t)}},c=o=>{try{l(i.throw(o))}catch(t){m(t)}},l=o=>o.done?d(o.value):Promise.resolve(o.value).then(g,c);l((i=i.apply(T,r)).next())});import{b as B,g as $,a as R}from"./captcha-CfyENt4d.js";import{aq as V,ap as a,ar as q,u as A,bo as D,bp as C,bq as E,br as U}from"./bootstrap-C83mKH3e.js";import{I as O}from"./index-tJhkz61M.js";import{T as z}from"./auth-title-BvGMG-4j.js";import{V as k,am as H,J as _,ak as J,_ as N,x as P,as as S,$ as I,X as L,a5 as w,a6 as y,U as p,aW as M,O as h,k as W,Z as X}from"../jse/index-index-GzxSC5Ev.js";import{u as Z,s as f}from"./use-vben-form-DZ0hU62q.js";import"./index-BLhXPpf9.js";import"./render-content.vue_vue_type_script_lang-DFpFIcwM.js";const j={class:"mt-4 text-center text-sm"},G=k({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(T,{expose:r,emit:i}){const d=T,m=i,[g,c]=Z(H({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:_(()=>d.formSchema),showDefaultActions:!1})),l=V();function o(){return b(this,null,function*(){const{valid:n}=yield c.validate(),u=yield c.getValues();n&&m("submit",u)})}function t(){l.push(d.loginPath)}return r({getFormApi:()=>c}),(n,u)=>(N(),J("div",null,[P(z,null,{desc:I(()=>[L(n.$slots,"subTitle",{},()=>[w(y(n.subTitle||p(a)("authentication.signUpSubtitle")),1)])]),default:I(()=>[L(n.$slots,"title",{},()=>[w(y(n.title||p(a)("authentication.createAnAccount"))+" ðŸš€ ",1)])]),_:3}),P(p(g)),P(p(q),{class:M([{"cursor-wait":n.loading},"mt-2 w-full"]),loading:n.loading,"aria-label":"register",onClick:o},{default:I(()=>[L(n.$slots,"submitButtonText",{},()=>[w(y(n.submitButtonText||p(a)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),S("div",j,[w(y(p(a)("authentication.alreadyHaveAccount"))+" ",1),S("span",{class:"vben-link text-sm font-normal",onClick:u[0]||(u[0]=v=>t())},y(p(a)("authentication.goToLogin")),1)])]))}}),ie=k({name:"Register",__name:"register",setup(T){const r=h(!1),i=V(),{isDark:d}=A(),m=h(""),g=h(""),c=h(""),l=h(""),o=[{label:a("sys.login.captcha"),value:"captcha"},{label:a("sys.login.mobile"),value:"mobile"},{label:a("sys.login.email"),value:"email"}];function t(){return b(this,null,function*(){const e=yield B();e.code===0&&(g.value=e.data.captchaId,m.value=e.data.imgPath)})}t();function n(){return b(this,null,function*(){return c.value==="email"?(yield $({email:l.value})).code===0:(yield R({phoneNumber:l.value})).code===0})}const u=h(""),v=_(()=>[{component:"VbenSelect",componentProps:{options:o},label:"Login Type",fieldName:"selectLoginType",rules:f().optional().default("captcha"),dependencies:{triggerFields:["selectLoginType"],trigger(e,s){c.value=e.selectLoginType}},formItemClass:"col-span-2 items-baseline"},{component:"VbenInput",componentProps:{placeholder:a("authentication.usernameTip")},fieldName:"username",label:a("authentication.username"),rules:f().min(1,{message:a("authentication.usernameTip")}),dependencies:{triggerFields:["selectLoginType"]},formItemClass:"col-span-2 items-baseline"},{component:"VbenInput",componentProps:{placeholder:u},label:"Target",fieldName:"target",dependencies:{trigger(e,s){u.value=e.selectLoginType==="email"||e.selectLoginType==="captcha"?a("sys.login.emailPlaceholder"):a("sys.login.mobilePlaceholder"),l.value=e.target},triggerFields:["selectLoginType","target"]},formItemClass:"col-span-2 items-baseline"},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:a("authentication.password")},renderComponentContent(){return{strengthText:()=>a("authentication.passwordStrength")}},fieldName:"password",label:a("authentication.password"),rules:f().min(6,{message:a("authentication.passwordTip")}),formItemClass:"col-span-2 items-baseline"},{component:"VbenInputPassword",componentProps:{placeholder:a("authentication.confirmPassword")},dependencies:{rules(e){const{password:s}=e;return f({required_error:a("authentication.passwordTip")}).min(1,{message:a("authentication.passwordTip")}).refine(F=>F===s,{message:a("authentication.confirmPasswordTip")})},triggerFields:["password"]},fieldName:"confirmPassword",label:a("authentication.confirmPassword"),formItemClass:"col-span-2 items-baseline"},{fieldName:"captcha",label:a("authentication.password"),dependencies:{if(e){return e.selectLoginType==="captcha"},triggerFields:["selectLoginType"]},component:"VbenInput",componentProps:{maxlength:5,placeholder:a("sys.login.smsPlaceholder")},formItemClass:"col-span-1 items-baseline",rules:f().length(5,{message:a("sys.login.captchaRequired")}).max(5)},{fieldName:"captchaImg",component:W(O),componentProps:{src:m.value,width:120,height:40,preview:!1,onClick:t,style:{backgroundColor:d.value?"#eee":"transparent"}},formItemClass:"col-span-1 items-baseline",dependencies:{if(e){return e.selectLoginType==="captcha"},triggerFields:["selectLoginType"]}},{component:"VbenPinInput",componentProps:{createText:e=>e>0?a("authentication.sendText",[e]):a("authentication.sendCode"),placeholder:a("authentication.code"),codeLength:5,handleSendCode:n},dependencies:{if(e){return e.selectLoginType!=="captcha"},triggerFields:["selectLoginType"]},fieldName:"captchaVerified",label:a("authentication.code"),rules:f().length(5,{message:a("sys.login.captchaRequired")}).max(5),formItemClass:"col-span-2 items-baseline"}]);function x(e){return b(this,null,function*(){switch(r.value=!0,e.selectLoginType){case"captcha":{U({password:e.password,username:e.username,captcha:e.captcha,captchaId:g.value,email:l.value}).then(s=>{s.code===0?(C.info(a("sys.login.signupSuccessTitle")),i.push("/auth/login")):s.code!==0&&t()}).catch(()=>{t()}).finally(()=>{r.value=!1});break}case"email":{E({captcha:e.captchaVerified,username:e.username,password:e.password,email:e.target}).then(s=>{s.code===0?(C.info(a("sys.login.signupSuccessTitle")),i.push("/auth/login")):s.code!==0&&t()}).catch(()=>{t()}).finally(()=>{r.value=!1});break}case"mobile":{D({captcha:e.captchaVerified,phoneNumber:e.target,username:e.username,password:e.password}).then(s=>{s.code===0?(C.info(a("sys.login.signupSuccessTitle")),i.push("/auth/login")):s.code!==0&&t()}).catch(()=>{t()}).finally(()=>{r.value=!1});break}}})}return(e,s)=>(N(),X(p(G),{"form-schema":v.value,loading:r.value,onSubmit:x},null,8,["form-schema","loading"]))}});export{ie as default};
