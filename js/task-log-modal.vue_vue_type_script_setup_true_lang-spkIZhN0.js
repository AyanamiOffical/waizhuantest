var c=(n,m,a)=>new Promise((f,s)=>{var g=t=>{try{i(a.next(t))}catch(r){s(r)}},p=t=>{try{i(a.throw(t))}catch(r){s(r)}},i=t=>t.done?f(t.value):Promise.resolve(t.value).then(g,p);i((a=a.apply(n,m)).next())});import{b1 as x,ap as l,cf as v,aW as L,ch as B}from"./bootstrap-B-VSIAtm.js";import{u as S,_ as O}from"./TableAction.vue_vue_type_style_index_0_lang-CJC400sX.js";import{b as D,e as T}from"./schemas-BSbmMMOD.js";import{V,O as C,k as $,Z as M,_ as R,$ as h,x as _,U as u,ar as A,a5 as E,a6 as I}from"../jse/index-index-fT_vxJqM.js";import{u as q}from"./use-modal-BhR4F9RI.js";const z=n=>x.post("/sys-api/task_log/list",n),G=n=>x.post("/sys-api/task_log/delete",n),H=V({name:"TaskLogModal",__name:"task-log-modal",setup(n,{expose:m}){const a=C(),f={collapsed:!1,schema:[...T.schema],showCollapseButton:!1,submitOnEnter:!1},s=C(!1),g={checkboxChange(e){s.value=e.$table.getCheckboxRecords().length>0},checkboxAll(e){s.value=e.$table.getCheckboxRecords().length>0}},p={checkboxConfig:{highlight:!0},toolbarConfig:{slots:{buttons:"toolbar-buttons"}},editConfig:{mode:"row",trigger:"click"},showOverflow:!0,columns:[...D.columns,{title:l("common.action"),fixed:"right",field:"action",slots:{default:({row:e})=>{var o;return $(O,{actions:[{icon:"ant-design:delete-outlined",type:"link",color:"error",tooltip:l("common.delete"),popConfirm:{title:l("common.deleteConfirm"),placement:"left",confirm:k.bind(null,[e.id])},ifShow:!((o=t.grid)!=null&&o.isEditByRow(e))}]})}}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(w,Q)=>c(this,[w,Q],function*({page:e},o){var b;return(yield z({page:e.currentPage,pageSize:e.pageSize,taskId:a.value,result:(b=o.result)!=null?b:0})).data})}}},[i,t]=S({gridOptions:p,formOptions:f,gridEvents:g});function r(){B.confirm({title:l("common.deleteConfirm"),onOk(){return c(this,null,function*(){const o=t.grid.getCheckboxRecords().map(w=>w.id);k(o)})}})}function k(e){return c(this,null,function*(){(yield G({ids:e})).code===0&&(s.value=!1),yield t.reload()})}const[y,d]=q({fullscreenButton:!1,onCancel(){d.close()},onConfirm:()=>c(this,null,function*(){d.close()}),onOpenChange(e){var o;e&&(a.value=(o=d.getData())==null?void 0:o.taskId)},title:l("sys.taskLog.taskLogList")});return m(d),(e,o)=>(R(),M(u(y),{class:"h-2/3 w-1/2"},{default:h(()=>[_(u(i),null,{"toolbar-buttons":h(()=>[A(_(u(v),{danger:"",type:"primary",onClick:r},{default:h(()=>[E(I(u(l)("common.delete")),1)]),_:1},512),[[L,s.value]])]),_:1})]),_:1}))}});export{H as _};
